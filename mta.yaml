_schema-version: 3.3.0
ID: zcapprotrac
description: First CAPM Project.
version: 1.0.0
modules:
#-----------------------------------------------------------------
  - name: zcapprotrac-srv
#-----------------------------------------------------------------  
    type: nodejs    
    path: gen/srv
    requires:
      - name: zcapprotrac-destination
      - name: zcapprotrac-connectivity
      - name: zcapprotrac-xsuaa
    provides:
      - name: srv-api
        properties:             
          srv-url: ${default-url}  #dont put it inside quote
    parameters:
      buildpack: nodejs_buildpack
      instances: 1
    build-parameters:
      builder: npm-ci

#-----------------------------------------------------------------      
  - name: zcapprotrac-ui
#-----------------------------------------------------------------  
    type: nodejs
    path: app
    requires:
      - name: srv-api
        group: destinations
        properties:
          name: srv-api
          url: ~{srv-url}
          forwardAuthToken: true
          strictSSL: true      
      - name: zcapprotrac-xsuaa
    parameters:
      buildpack: nodejs_buildpack
      build-parameters:
        builder: npm-ci    
resources:
  - name: zcapprotrac-destination
    type: org.cloudfoundry.managed-service
    parameters:
      config: null
      HTML5Runtime_enabled: false
      init_data:
        instance:
          destinations:
            - Authentication: NoAuthentication
              Name: ui5
              ProxyType: Internet
              Type: HTTP
              URL: 'https://ui5.sap.com'
          existing_destinations_policy: update
      service: destination
      service-plan: lite

  - name: zcapprotrac-connectivity
    type: org.cloudfoundry.managed-service
    description: Connectivity Service
    parameters:
      service: connectivity
      service-plan: lite

  - name: zcapprotrac-xsuaa
    type: org.cloudfoundry.managed-service
    parameters:
      config:
        xsappname: zcapprotrac-${space}
      path: ./xs-security.json
      service: xsuaa
      service-plan: application    
parameters:
  enable-parallel-deployments: true      
